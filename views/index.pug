doctype html
html(lang='en')
  head
    meta(charset='utf-8')
    meta(name='viewport' content='width=device-width, initial-scale=1')
    title My story points
    script(src="https://cdn.tailwindcss.com")
    link(rel='stylesheet' href='/css/index.css')
    link(rel="icon" href="/img/logo.png" type="image/x-icon")
  body#todo-list
    section
      header.w-full.bg-indigo-500.py-3.px-5.text-white.text-left
        a.text-xl.font-bold(href="https://github.com/arturxdev/mystorypoints") Repositorio
      div(class="w-5/6 mx-auto mt-10")
        div(class="w-2/4 m-auto")
          img(src="/img/logo-full.png")
        p.mt-5.text-xl.text-center.mb-20.font-semibold.text-gray-600 Visualiza tus story points de una manera f√°cil para saber tu rendimiento
        .tooltip.mb-5
          button.px-5.py-2.bg-indigo-500.rounded-md.text-white.font-bold.flex.items-center(onclick="myFunction()")
            span.tooltiptext#myTooltip copiar link al clipboard
            img.mr-1.inline-block(src="/img/icons/file-copy-line.svg" width="20px")
            span Copiar link
        form(hx-get="/", hx-target="#todo-list" hx-push-url="true")
          .w-full
            span Usuario a buscar
            input(class="px-3 py-2 mb-4 w-full border border-gray-300 rounded-md focus:border-rose-500" name="userId",placeholder='Jira userId a buscar' required value=params.userId)
          .block.self-center.mb-4
            label.mr-1 1M
            input(type="radio" name="months" value="1" required checked=params.months===1)
            label.ml-2.mr-1 2M
            input(type="radio" name="months" value="2" required checked=params.months===2)
            label.ml-2.mr-1 3M
            input(type="radio" name="months" value="3" required checked=params.months===3)
          button.px-5.py-2.bg-indigo-500.rounded-md.text-white.font-bold.flex.items-center 
            img.mr-1.inline-block(src="/img/icons/search-line.svg" width="20px")
            span Buscar
      div(class="w-5/6 mx-auto mt-2")
        .flex.rounded-md.justify-between.px-5.py-5.bg-indigo-50.my-10
          div 
            p.mt-2 
              span.font-medium Semana actual: 
              span.text-indigo-500 #{actual}
            p 
              span.font-medium Tareas sin clasificar: 
              span.text-indigo-500 #{unclasificated.length}
          .self-center
            button.px-5.py-2.bg-indigo-500.rounded-md.text-white.font-bold.flex.items-center(onclick="location.reload()") 
              img.mr-1.inline-block(src="/img/icons/loop-left-line.svg" width="20px")
              span Actualizar
        div.flex.justify-start.mt-2.flex-wrap
          each task in unclasificated
            .inline-block.bg-rose-200.border.border-rose-500.tag.px-2.py-2.border.rounded-md.mr-2.my-2.drop-shadow-lg.tooltip
              span.tooltiptext #{task.summary}
              a.text-xs(href=`https://koibanx.atlassian.net/browse/${task.key}` target="_blank_") 
                p
                  span.font-semibold #{task.key}
                p
                  span.mr-2 #{task.issueType}
                  span.mr-2(class=`${task.endDate ? "":"text-red-500"}`) endDate
                  span.mr-2(class=`${task.storyPoint ? "":"text-red-500"}`) storyPoints
        div(class="mx-auto w-full flex justify-center my-10")
          table.w-full
            thead
              tr
                th Semana
                th Fecha Inicio
                th Fecha Final
                th Story points
                th Issues
            tbody
              each week,yearIndex in cal
                tr
                  td.text-center
                    span #{week.year}-#{week.week}
                  td.text-center
                    span #{week.start}
                  td.text-center
                    span #{week.end}
                  td.text-center
                    span #{week.total}
                  td
                     each task in week.issues
                        .inline-block.tooltip
                          span.tooltiptext #{task.summary}
                          a.px-2.py-2.my-2.border.ml-2.text-xs.rounded-md.tooltip(class=`${(task.resolution==='Done' || task.resolution==='Finalizado')?"bg-green-200 border border-green-500":"bg-amber-200 border border-amber-500"}` href=`https://koibanx.atlassian.net/browse/${task.key}` target="_blank_") 
                            p
                              span.font-semibold #{task.key}
                              span.ml-2 #{task.storyPoint}

    script(src='https://unpkg.com/htmx.org@1.3.1')
    script(src='https://unpkg.com/htmx.org@1.3.1')
    script(src='/js/main.js')

