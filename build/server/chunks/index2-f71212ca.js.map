{"version":3,"file":"index2-f71212ca.js","sources":["../../../.svelte-kit/adapter-node/chunks/index2.js"],"sourcesContent":["import dayjs from \"dayjs\";\nimport axios from \"axios\";\nimport weekOfYear from \"dayjs/plugin/weekOfYear.js\";\nconst TOKEN_JIRA = \"ATATT3xFfGF0H0XpZZDjCoJIJOB7oQoG49KN-Gu7SxTPAzHuBSSpS5JvvcstmmqBHSUykRLH2VSinC6_A2zfueoMKzPhoT9RPCEc42DqQYFFXTtXhef5KIjFuKtLioRkejQjVwRBBH5jikvTniHO63LeMxGt-ojcmsB5J4LWF7tcMDdMPX3rTp8=28E8FE61\";\ndayjs.extend(weekOfYear);\nfunction getWeekNumber(date) {\n  const firstDayOfYear = new Date(date.getFullYear(), 0, 1);\n  const millisecondsPerDay = 24 * 60 * 60 * 1e3;\n  const diff = (date - firstDayOfYear) / millisecondsPerDay;\n  return Math.ceil((diff + firstDayOfYear.getDay() + 1) / 7);\n}\nfunction getMinMaxDates(tasks) {\n  let minor = dayjs();\n  let major = dayjs();\n  let issueTypes = [];\n  for (let index = 0; index < tasks.length; index++) {\n    if (!issueTypes.includes(tasks[index].issueType))\n      issueTypes.push(tasks[index].issueType);\n    if (!tasks[index].endDate)\n      continue;\n    const issueDate = dayjs(tasks[index].endDate);\n    if (issueDate.isBefore(minor, \"week\"))\n      minor = issueDate;\n    if (issueDate.isAfter(major, \"week\"))\n      major = issueDate;\n  }\n  return { minor, major, issueTypes };\n}\nfunction genCal(dateStart, dateEnd) {\n  const calStart = dateStart.getDay() === 0 ? dateStart : dateStart.setDate(dateStart.getDate() - dateStart.getDay() + 1);\n  const calEnd = dateStart.getDay() === 6 ? dateEnd : dateEnd.setDate(dateEnd.getDate() + (6 - dateEnd.getDay()));\n  const weeksArray = [];\n  let currentWeek = [];\n  let currentDate = new Date(calStart);\n  while (currentDate <= calEnd) {\n    const weekDay = currentDate.getDay();\n    if (weekDay === 0 && currentWeek.length > 0) {\n      weeksArray.push(currentWeek);\n      currentWeek = [];\n    }\n    currentWeek.push(new Date(currentDate));\n    currentDate.setDate(currentDate.getDate() + 1);\n  }\n  if (currentWeek.length > 0) {\n    weeksArray.push(currentWeek);\n  }\n  let cal = {};\n  for (let index = 0; index < weeksArray.length; index++) {\n    const firstDayOfWeek = weeksArray[index][1];\n    const year = firstDayOfWeek.getFullYear();\n    const weekNumber = getWeekNumber(firstDayOfWeek);\n    const lastDayOfWeek = weeksArray[index][weeksArray[index].length - 1];\n    cal[`${year}-${weekNumber}`] = {\n      year,\n      week: weekNumber,\n      start: firstDayOfWeek.toISOString().split(\"T\")[0],\n      end: lastDayOfWeek.toISOString().split(\"T\")[0],\n      days: weeksArray[index].map((day) => day.toISOString().split(\"T\")[0]),\n      total: 0,\n      issues: []\n    };\n  }\n  return cal;\n}\nasync function getTaskJira(userId, startAt = 0) {\n  const jiraUser = \"arturo.guerrero@koibanx.com\";\n  const token = TOKEN_JIRA;\n  const url = \"https://koibanx.atlassian.net/rest/api/3/search\";\n  const params = {\n    jql: `assignee = \"${userId}\" AND created >= startOfMonth(-3M) AND created <= endOfMonth()`,\n    startAt,\n    maxResults: 100\n  };\n  const headers = {\n    Authorization: `Basic ${Buffer.from(jiraUser + \":\" + token).toString(\"base64\")}`,\n    Accept: \"application/json\"\n  };\n  const response = await axios({\n    method: \"get\",\n    url,\n    headers,\n    params\n  });\n  return response.data;\n}\nasync function getTasks(months, userId) {\n  if (!months || !userId)\n    return { success: false };\n  try {\n    let cal = [];\n    let unclasificated = [];\n    let dataResults = [];\n    const actual = dayjs().week();\n    const jiraResponse = await getTaskJira(userId, 0);\n    dataResults.push(...jiraResponse.issues);\n    if (Math.ceil(jiraResponse.total / 100) > 1) {\n      for (let index = 1; index < Math.ceil(jiraResponse.total / 100); index++) {\n        const jiraResponse2 = await getTaskJira(userId, index * 100);\n        dataResults.push(...jiraResponse2.issues);\n      }\n    }\n    const tasks = dataResults.map((issue) => {\n      return {\n        summary: issue.fields.summary,\n        storyPoint: issue.fields.customfield_10102 ?? issue.fields.customfield_10016,\n        key: issue.key,\n        startDate: issue.fields.customfield_10015,\n        endDate: issue.fields.customfield_10143,\n        resolution: issue.fields.status ? issue.fields.status.name : null,\n        issueType: issue.fields.issuetype.name\n      };\n    });\n    const { minor, major, issueTypes } = getMinMaxDates(tasks);\n    cal = genCal(minor.subtract(2, \"week\").toDate(), major.add(1, \"week\").toDate());\n    for (let index = 0; index < tasks.length; index++) {\n      if (tasks[index].endDate && tasks[index].storyPoint) {\n        const issue = cal[`${dayjs(tasks[index].endDate).year()}-${dayjs(tasks[index].endDate).week()}`];\n        issue.total += tasks[index].storyPoint;\n        issue.issues.push(tasks[index]);\n      } else {\n        unclasificated.push(tasks[index]);\n      }\n    }\n    return { success: true, actual, cal, unclasificated, issueTypes };\n  } catch (error) {\n    console.log(error.response.data);\n    return { success: false };\n  }\n}\nexport {\n  getTasks as g\n};\n"],"names":[],"mappings":"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"}